<?php 


$bounced_beacontest = <<<BOUNCE_AOL_BEACONTEST
Return-path: <>
Envelope-to: bounce@glocksoft.com
Delivery-date: Wed, 17 Oct 2012 10:05:28 +0300
Received: from a192-77.smtp-out.amazonses.com ([199.255.192.77]:47802)
	by server.glocksoft.com with esmtp (Exim 4.77)
	id 1TONgw-0006BT-5M
	for bounce@glocksoft.com; Wed, 17 Oct 2012 10:05:28 +0300
X-Original-To: complaints@email-abuse.amazonaws.com
Delivered-To: complaints@email-abuse.amazonaws.com
To: bounce@glocksoft.com
From: complaints@email-abuse.amazonses.com
Date: Wed, 17 Oct 2012 07:05:21 +0000
Subject: Email Feedback Report for IP 199.127.232.181
MIME-Version: 1.0
Content-Type: multipart/report; report-type=feedback-report; boundary="boundary-1138-29572-2659438-30394"
X-AOL-INRLY: b232-181.smtp-out.amazonses.com [199.127.232.181] scmp-d004
X-Loop: scomp
X-AOL-IP: 172.29.255.78
Message-ID: <0000013a6d8a72ff-03ab7447-1829-11e2-a203-811ebdd20fae-000000@email.amazonses.com>
X-SES-Outgoing: 199.255.192.77
X-Spam-Status: No, score=-1.3
X-Spam-Score: -12
X-Spam-Bar: -
X-Ham-Report: Spam detection software, running on the system "server.glocksoft.com", has
 identified this incoming email as possible spam.  The original message
 has been attached to this so you can view it (if it isn't spam) or label
 similar future email.  If you have any questions, see
 the administrator of that system for details.
 
 Content preview:  This is an email abuse report for an email message with the
    message-id of 0000013a69d1ad16-7b7e9918-e22f-444d-a8b6-ad785084f546-000000@email.amazonses.com
    received from IP address 199.127.232.181 on Tue, 16 Oct 2012 09:44:41 -0400
    (EDT) [...] 
 
 Content analysis details:   (-1.3 points, 5.0 required)
 
  pts rule name              description
 ---- ---------------------- --------------------------------------------------
 -1.9 BAYES_00               BODY: Bayes spam probability is 0 to 1%
                             [score: 0.0000]
  0.0 HTML_MESSAGE           BODY: HTML included in message
  0.6 AWL                    AWL: From: address is in the auto white-list
X-Spam-Flag: NO


--boundary-1138-29572-2659438-30394
Content-Type: text/plain; charset="US-ASCII"
Content-Transfer-Encoding: 7bit

This is an email abuse report for an email message with the message-id of 0000013a69d1ad16-7b7e9918-e22f-444d-a8b6-ad785084f546-000000@email.amazonses.com received from IP address 199.127.232.181 on Tue, 16 Oct 2012 09:44:41 -0400 (EDT)

For information, please review the top portion of the following page:
http://postmaster.aol.com/Postmaster.FeedbackLoop.php

For information about AOL E-mail guidelines, please see
http://postmaster.aol.com/Postmaster.Guidelines.php

If you would like to cancel or change the configuration for your FBL please use the tool located at: 
http://postmaster.aol.com/SupportRequest.FBL.php


--boundary-1138-29572-2659438-30394
Content-Disposition: inline
Content-Type: message/feedback-report

Feedback-Type: abuse
User-Agent: AOL SComp
Version: 0.1
Received-Date: Tue, 16 Oct 2012 09:44:41 -0400 (EDT)
Source-IP: 199.127.232.181
Reported-Domain: b232-181.smtp-out.amazonses.com
Redacted-Address: redacted
Redacted-Address: redacted@


--boundary-1138-29572-2659438-30394
Content-Type: message/rfc822
Content-Disposition: inline

Return-Path: <0000013a69d1ad16-7b7e9918-e22f-444d-a8b6-ad785084f546-000000@amazonses.com>
Received: from b232-181.smtp-out.amazonses.com (b232-181.smtp-out.amazonses.com [199.127.232.181])
	by mtain-dk07.r1000.mx.aol.com (Internet Inbound) with ESMTP id 47ABA380000F9
	for <redacted@aol.com>; Tue, 16 Oct 2012 09:44:41 -0400 (EDT)
List-Unsubscribe: <http://glockdb.com/u.php?xemail=emFyYWxlYWhhQGFvbC5jb20>,  <http://glocksoft.com/u.php?xemail=emFyYWxlYWhhQGFvbC5jb20>
Organization: G-Lock Software
Reply-To: support@glocksoft.com
Message-ID: <0000013a69d1ad16-7b7e9918-e22f-444d-a8b6-ad785084f546-000000@email.amazonses.com>
From: "Julia Gulevich [GLockSoft]" <support@glocksoft.com>
To: redacted@aol.com
Subject: [Fast Blog Finder] Critical bug fixed
Date: Tue, 16 Oct 2012 13:44:40 +0000
MIME-Version: 1.0
Content-Type: multipart/alternative;
	boundary="----=SPLITOR00A_001_25951437D"
X-SES-Outgoing: 199.127.232.181
x-aol-global-disposition: G
x-aol-sid: 3039ac1db40b507d64c9254b
X-AOL-IP: 199.127.232.181
X-WPNewsman-antispam: RCqrB8oUy1PSy8sQFYaOB8oE
X-AOL-SPF: domain : amazonses.com SPF : pass

This is a multi-part message in MIME format.

------=SPLITOR00A_001_25951437D
Content-Type: text/plain;
	charset="WINDOWS-1252"
Content-Transfer-Encoding: quoted-printable

Hi, we released Fast Blog Finder v3.5.1 and highly recommend that you =
upgrade=2E

In this version we fixed a critical bug in the internal search engine =
which did not work as it should=2E

Plus, we made Fast Blog Finder compatible with virtual machines=2E

You can download Fast Blog Finder v3.5.1 from the link below:     =20
  =20
http://mirror1.glocksoft.com/fastblogfinder.zip   =20
  =20
Overwrite your current version of Fast Blog Finder with the 3.5.1 =
version.=20

Your registration is valid for the v3.5.1. =20
  =20
Should you have any questions, don't hesitate to contact me.   =20
  =20
Julia Gulevich=20
G-Lock Software=20
julia@glocksoft.com=20
http://www.fastblogfinder.com/

P.S Follow us on Twitter https://twitter.com/glocksoft to receive updates =
from @glocksoft=2E
  =20


  =20
--=20
Our records indicate that you registered Fast Blog Finder on 2010-11-18.=20
Your personal key is 38GC2KD-HXVS9.   =20
  =20
No longer interested? Unsubscribe via the link below:   =20
http://glockdb.com/u?xemail=3DemFyYWxlYWhhQGFvbC5jb20   =20















------=SPLITOR00A_001_25951437D
Content-Type: text/html;
	charset="WINDOWS-1252"
Content-Transfer-Encoding: quoted-printable

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML><HEAD>
<META content=3D"text/html; charset=3Dwindows-1252" =
http-equiv=3D"Content-Type">
<META name=3D"GENERATOR" content=3D"MSHTML 10.00.9200.16420">
<STYLE> span.yshortcuts { color: inherit !important; border-bottom: none =
!important; } /*Body text color*/
a span.yshortcuts { color: inherit !important; } /*Link text color*/ =
</STYLE>
</HEAD>
<BODY>
<TABLE style=3D"BORDER-COLLAPSE: collapse" width=3D"600" border=3D"0">
  <TBODY>
  <TR>
    <TD>
      <DIV><SPAN style=3D"FONT-SIZE: 10pt; FONT-FAMILY: Segoe UI, =
Tahoma,Verdana,Arial,sans-serif; COLOR: #000">Hi,=20
      we released Fast Blog Finder v3.5.1 and highly recommend that you=20
      upgrade.</SPAN></DIV><BR>
      <DIV><SPAN style=3D"FONT-SIZE: 10pt; FONT-FAMILY: Segoe UI, =
Tahoma,Verdana,Arial,sans-serif; COLOR: #000">In=20
      this version we fixed a critical bug in the internal search engine =
which=20
      did not work as it should.</SPAN></DIV><BR>
      <DIV><SPAN style=3D"FONT-SIZE: 10pt; FONT-FAMILY: Segoe UI, =
Tahoma,Verdana,Arial,sans-serif; COLOR: #000">Plus,=20
      we made Fast Blog Finder compatible with virtual=20
machines.</SPAN></DIV><BR>
      <DIV><SPAN style=3D"FONT-SIZE: 10pt; FONT-FAMILY: Segoe UI, =
Tahoma,Verdana,Arial,sans-serif; COLOR: #000">&gt;&gt;&gt;=20
      <A href=3D"http://mirror1.glocksoft.com/fastblogfinder.zip">Download =
Fast=20
      Blog Finder v3.5.1</A> </SPAN></DIV><BR>
      <DIV><SPAN style=3D"FONT-SIZE: 10pt; FONT-FAMILY: Segoe UI, =
Tahoma,Verdana,Arial,sans-serif; COLOR: #000">Overwrite=20
      your current version of Fast Blog Finder with the 3.5.1 version. =
Your=20
      registration is valid for the v3.5.1.</SPAN></DIV><BR>
      <DIV><SPAN style=3D"FONT-SIZE: 10pt; FONT-FAMILY: Segoe UI, =
Tahoma,Verdana,Arial,sans-serif; COLOR: #000">Should=20
      you have any questions, don't hesitate to contact =
me.</SPAN></DIV><BR>
      <TABLE id=3D"table1" style=3D"BORDER-COLLAPSE: collapse" =
border=3D"0">
        <TBODY>
        <TR>
          <TD width=3D"100"><IMG border=3D"0" hspace=3D"5" alt=3D"Photo" =
align=3D"left" src=3D"http://www.glocksoft.com/images/Julia3.png"></TD>
          <TD><SPAN style=3D"FONT-SIZE: 10pt; FONT-FAMILY: Segoe UI, =
Tahoma,Verdana,Arial,sans-serif; COLOR: #000">
            <P><BR>Julia Gulevich <BR>G-Lock Software<BR><A =
href=3D"mailto:julia@glocksoft.com">julia@glocksoft.com</A><BR></SPAN><SPAN=
 style=3D"FONT-SIZE: 10pt; FONT-FAMILY: Segoe UI, =
Tahoma,Verdana,Arial,sans-serif; COLOR: #000"><A =
href=3D"http://www.fastblogfinder.com/">http://www.fastblogfinder.com/</A><=
/SPAN>&nbsp;</P></TD></TR></TBODY></TABLE><BR></TD></TR></TBODY></TABLE>
<DIV><SPAN style=3D"FONT-SIZE: 10pt; FONT-FAMILY: Segoe UI, =
Tahoma,Verdana,Arial,sans-serif; COLOR: #000">P.S=20
<A href=3D"https://twitter.com/glocksoft" target=3D"_blank">Follow us on =
Twitter</A>=20
to receive updates from @glocksoft. </SPAN></DIV><BR><BR><BR><BR><BR>
<DIV><SPAN style=3D"FONT-SIZE: 12px; FONT-FAMILY: Segoe UI, =
Tahoma,Verdana,Arial,sans-serif; COLOR: #666666">--<BR>Our=20
records indicate that you registered Fast Blog Finder edition on=20
2010-11-18. <BR>Your personal key is 38GC2KD-HXVS9. </SPAN><BR><BR><SPAN =
style=3D"FONT-SIZE: 12px; FONT-FAMILY: Segoe UI, =
Tahoma,Verdana,Arial,sans-serif; COLOR: #666666">No=20
longer interested? </SPAN><A =
href=3D"http://glockdb.com/u?xemail=3DemFyYWxlYWhhQGFvbC5jb20"><SPAN =
style=3D"FONT-SIZE: 12px; FONT-FAMILY: Segoe UI, =
Tahoma,Verdana,Arial,sans-serif; COLOR: #666666">Unsubscribe=20
here</SPAN></A><BR><BR></DIV></BODY></HTML>





------=SPLITOR00A_001_25951437D--


--boundary-1138-29572-2659438-30394--

BOUNCE_AOL_BEACONTEST;



require_once('../../../../wp-load.php');
require_once('../lib/bounced/bounce_driver.class.php');


/*----------------------------------------------------*/
/*		Email base64 encofing with translation        */
/*		to use in beacon					          */
/*----------------------------------------------------*/

//*

function genTranslationMap($str) {
	return str_shuffle($str);
}

global $base64Map;
global $base64TrMap;


$base64Map = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';
$base64TrMap = 'SM3L+l2mjPbkhxVwWgAczqY1ByFR6e5p7QI0U/CuT9tiJEOranGN4s8ZHDdfKoXv'; // genTranslationMap($base64Map);

echo '<h2>Translation Map</h2>';
echo $base64TrMap.'<br><br>';

function encEmail($email) {
	global $base64Map;
	global $base64TrMap;

	return strtr(base64_encode($email), $base64Map, $base64TrMap);
}

function decEmail($enc_email) {
	global $base64Map;
	global $base64TrMap;

	return base64_decode(strtr($enc_email, $base64TrMap, $base64Map));
}

$my_email = 'neocoder@gmail.com';
assert( decEmail(encEmail($my_email)) === $my_email );

echo '<pre>b64 	 - '.base64_encode($my_email).'</pre>';
echo '<pre>b64 mod  - '.encEmail($my_email).'</pre>'; 

//*/

/* ----------------------------------------------------------------- */

$bouncehandler = new Bouncehandler();
$bouncehandler->x_header_search_1 = "X-WPNewsman-antispam";
//$bouncehandler->x_header_search_2 = "X-sumthin-sumpin";

$multiArray = $bouncehandler->get_the_facts($bounced_beacontest);

echo '<pre>';
print_r($multiArray);
echo '</pre>';

if ( $bouncehandler->x_header_beacon_1 ) {
	echo 'Email from beacon: '.decEmail($bouncehandler->x_header_beacon_1).'<br>';	
}


//exit();


if ( function_exists('imap_open') ) {
	echo 'imap_open - OK <br>';
} else {
	echo 'imap_open - FAIL <br>';
}

$mode = 'POP3';

$host = 'mail.glocksoft.com';
$port = 110;// 143; // 110

$username = 'bounce@glocksoft.com';
$password = 'vfndttdbx';

// $username = 'support@glocksoft.com';
// $password = 'ghbdtn76';

$connStr = "{mail.glocksoft.com:143}";

// if ( $mode == 'IMAP' ) {
// 	$mbox = imap_open($connStr, $username, $password);
// } else { // POP3
// 	$mbox = imap_open($connStr, $username, $password);
// }

$mbox = imap_open($connStr.'', $username, $password);

if ( $mbox ) {

	function getBouncedStatus($c, $uid) {
		$headers = imap_fetchheader($c, $uid, FT_UID || FT_PREFETCHTEXT);
		$body = imap_body($c, $uid, FT_UID);

		$eml = $headers . "\n" . $body;

		$bouncehandler = new Bouncehandler();
		$bouncehandler->x_header_search_1 = "X-WPNewsman-antispam";
		//$bouncehandler->x_header_search_2 = "X-sumthin-sumpin";

		$multiArray = $bouncehandler->get_the_facts($eml);

		if ( is_array($multiArray) && !empty($multiArray) ){
			echo '<pre>';
			print_r($multiArray);
			echo '</pre>';

			if ( $bouncehandler->x_header_beacon_1 ) {
				echo 'Email from beacon: '.decEmail($bouncehandler->x_header_beacon_1);	
			}

			return true;					
		}
	}

	function getEmail($c, $uid) {
		$headers = imap_fetchheader($c, $uid, FT_UID || FT_PREFETCHTEXT);
		$body = imap_body($c, $uid, FT_UID);

		$eml = $headers . "\n" . $body;
		return $eml;
	}


	// echo "<h1>Mailboxes</h1>\n";
	// $mbox_list = imap_open($connStr, $username, $password);
	// $folders = imap_listmailbox($mbox_list, $connStr, "*");

	// if ($folders == false) {
	//     echo "Call failed<br />\n";
	// } else {
	//     foreach ($folders as $val) {
	//         echo $val . "<br />\n";
	//     }
	// }

	echo '<h1>EMAILS</h2>';

	//$emails = imap_fetch_overview($mbox, '*', FT_UID);

	$emails = imap_search($mbox, 'ALL', SE_UID);

	//print_r($emails);

	$c = 0;
	$bc = 0;

	foreach ($emails as $uid) {		
		$c += 1;
		if ( getBouncedStatus($mbox, $uid) ) {
			$bc += 1;
			echo '<h3>Bounce detected - '.$uid.'</h3>';
			echo '<textarea style="width: 450px; height: 150px;">';
			echo htmlentities(getEmail($mbox, $uid));
			echo '</textarea>';
			echo '<br>';
		}		
	}

	echo "<p>Processed: $c emails</p>";
	echo "<p>Detected bounces: $bc</p>";

	//echo '<h1>MESSAGE</h1>';





	/*
	echo "<h1>Headers in INBOX</h1>\n";
	$headers = imap_headers($emails);

	if ($headers == false) {
	    echo "Call failed<br />\n";
	} else {
	    foreach ($headers as $val) {
	        echo $val . "<br />\n";
	    }
	}
	//*/

	imap_close($mbox);
} else {
	$str = imap_errors();

	echo '<pre>';
	print_r($str);
	echo '</pre>';
}

